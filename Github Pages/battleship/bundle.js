(()=>{"use strict";class e{constructor(e){this.display=e}#e(){const e=document.createElement("h1");return e.className="header__title",e.textContent="BATTLE/SHIP",e}#t(){const e=document.createElement("div");return e.className="header__buttons-row",e.append(this.#s()),e}#s(){const e=document.createElement("button");return e.className="header__button",e.textContent="PLAY",e.addEventListener("click",(()=>{this.display.render("playerSelection")})),e}render(){const e=document.createElement("header");return e.append(this.#e(),this.#t()),e}}class t{constructor(e){this.display=e}render(){const t=new DocumentFragment,s=new e(this.display).render();return t.append(s),t}}class s{#n=["EASY","HARD"];constructor(e){this.display=e}render(){const e=document.createElement("form");return e.method="post",e.className="player-form one-player",e.append(this.#r(),this.#a(),this.#i()),e}#r(){const e=document.createElement("label");e.for="player1-name",e.textContent="Your name:",e.className="player-form__name";const t=document.createElement("input");return t.type="text",t.name="player1-name",t.id="player1-name",t.required=!0,t.addEventListener("input",(()=>{this.startButton.disabled=!t.value.trim()})),this.player1Name=t,e.append(t),e}#a(){const e=document.createElement("div");e.textContent="Difficulty:",e.className="player-form__difficulty";const t=document.createElement("div");t.className="player-form__difficulty-spinner";const s=document.createElement("button");s.type="button",s.textContent="<",s.addEventListener("click",(()=>{let e=this.#n.indexOf(r.textContent);r.textContent=0===e?this.#n[this.#n.length-1]:this.#n[e-1]}));const n=document.createElement("button");n.type="button",n.textContent=">",n.addEventListener("click",(()=>{let e=this.#n.indexOf(r.textContent);r.textContent=this.#n[(e+1)%this.#n.length]}));const r=document.createElement("div");return r.id="player-form__difficulty-value",r.textContent=this.#n[0],this.difficulty=r,t.append(s,r,n),e.append(t),e}#i(){const e=document.createElement("input");return e.type="submit",e.value="START",e.disabled=!0,this.startButton=e,e.addEventListener("click",(e=>{e.preventDefault();const t=this.player1Name.value,s=this.#n.indexOf(this.difficulty.textContent);this.display.game.player1.name=t,this.display.game.difficulty=s,this.display.render("game")})),e}}class n{constructor(e){this.display=e}render(){const e=new DocumentFragment;let t=null;return t=new s(this.display).render(),e.append(t),e}}class r{constructor({board:e,isOpponent:t}){this.board=e,this.isOpponent=t,this.boardElement=document.createElement("section"),this.#l(this.boardElement)}render(){return this.boardElement}#l(e){const t=this.board.length;e.className="player-board";let s=this.#o(t);for(let e=0;e<t;e++){s+=this.#c(e);for(let n=0;n<t;n++)s+=this.#h(this.board[e][n],e,n)}e.innerHTML=s}#c(e){return`\n    <div class="cell header">\n      ${String.fromCharCode(65+e)}\n    </div>`}#o(e){let t='<div class="empty header"></div>';for(let s=0;s<e;s++)t+=`\n      <div class="cell header">\n        ${s+1}\n      </div> \n      `;return t}#h(e,t,s){return`\n    <div class="cell ${this.isOpponent?"target":""} ${this.#d(e)}" data-column="${t}" data-row="${s}">\n    </div>\n  `}#d(e){return e.isPlayed?e.placedShip?e.placedShip.isSunk()?"sunk":"hit":"miss":e.placedShip?"ship":""}}class a{constructor({ships:e,isOpponent:t}){this.ships=e,this.isOpponent=t}#p(e){const t=document.createElement("div");t.className="ship",t.className+=e.isSunk()?" sunk":"";for(let s=0;s<e.length;s++){const n=document.createElement("div");n.className="ship-cell",this.isOpponent?n.className+=e.isSunk()?" hit":"":n.className+=s<e.hits?" hit":"",t.append(n)}return t}render(){const e=document.createElement("section");return e.className="player-ships",this.ships.forEach((t=>{e.append(this.#p(t))})),e}}class i{constructor(e){this.winner=e}render(){const e=document.createElement("section");e.className="game-winner";const t=document.createElement("h2");return t.textContent=`${this.winner.toUpperCase()} WINS`,e.append(t,this.#u()),e}#u(){const e=document.createElement("button");return e.textContent="REPLAY",e}}class l{constructor(e){this.display=e,this.game=e.game,this.player1=this.game.player1,this.player2=this.game.player2}#m(){const e=document.querySelector(".game-area");e.innerHTML="",e.append(this.#y(this.player1),this.#y(this.player2)),this.game.winner&&this.#E(e)}#y(e){const t=document.createElement("section");t.className="player-area";const s=document.createElement("h2");return s.className="player-name",s.textContent=`${e.name.toUpperCase()}'S SHIPS`,t.append(this.#f(e),s,new a({ships:e.gameboard.ships,isOpponent:e===this.game.opponent}).render()),t}#f(e){const t=e===this.game.opponent,s=new DocumentFragment;return s.appendChild(new r({board:e.gameboard.board,isOpponent:t}).render()),t&&this.#S(s),s}#E(e){const t=new i(this.game.winner.name).render(),s=t.querySelector("button");this.#g(s),e.querySelectorAll("h2").forEach((e=>e.style.visibility="hidden")),e.querySelectorAll(".player-ships").forEach((e=>e.style.visibility="hidden")),document.querySelectorAll(".player-board").forEach((e=>{this.#C(e)})),e.append(t)}#g(e){e.addEventListener("click",(()=>{this.game.resetGame(),this.player1=this.game.player1,this.player2=this.game.player2,this.#m()}))}#S(e){const t=e.querySelectorAll(".cell");this.boundClickOnBoardEvent=this.#I.bind(this),t.forEach((e=>{e.addEventListener("click",this.boundClickOnBoardEvent)}))}#C(e){e.querySelectorAll(".cell").forEach((e=>{e.className=e.className.replace(" target",""),e.removeEventListener("click",this.boundClickOnBoardEvent)}))}#I(e){const t=Number(e.target.dataset.column),s=Number(e.target.dataset.row);try{this.game.play([t,s])}catch(e){console.error(e)}this.#m()}render(){const e=document.createElement("section");return e.className="game-area",e.append(this.#y(this.player1),this.#y(this.player2)),e}}class o{#v(e){const t=document.createElement("button");return t.className="nav__modal-close",t.textContent="X",t.addEventListener("click",(()=>{e.className="nav__modal hidden"})),t}#w(){const e=document.createElement("p");return e.className="nav__modal-content",e.innerHTML="\n      In Battleship, two players compete to sink each other's fleet of ships. Each player has a 10x10 grid where they secretly place their ships: one Aircraft Carrier (5 squares), one Battleship (4 squares), one Submarine (3 squares), one Cruiser (3 squares), and two Destroyer (2 squares). Remember, players cannot move their ships once the game starts, and keeping ship placements secret is crucial for strategy. <br>\n      <br> \n\n      Players take turns calling clickon on the opponent's grid to attack their ships. When all parts of a ship are hit, the ship is sunk. <br>\n      <br> \n\n      The game continues until one player sinks all of the opponent's ships, declaring them the winner.  Enjoy the game!\n    ",e}render(){const e=document.createElement("div");return e.role="dialog",e.className="nav__modal hidden",e.append(this.#v(e),this.#w()),e}}class c{#b(){const e=document.createElement("h1");return e.className="nav__logo",e.textContent="BATTLE/SHIP",e}#P(){const e=new DocumentFragment,t=document.createElement("button");t.className="nav__help",t.textContent="?Help";const s=(new o).render();return t.addEventListener("click",(()=>{s.className="nav__modal"})),e.append(t,s),e}render(){const e=document.createElement("nav");return e.className="nav",e.append(this.#b(),this.#P()),e}}class h{render(){const e=document.createElement("footer");return e.className="footer",e.innerHTML='\n      <p>\n        Made with <3 by <a href="https://github.com/Auliviet">Auliviet</a>\n      </p>\n    ',e}}class d{constructor(e="placeholderShip",t=1){this.name=e,this.length=t>0?t:1,this.hits=0}hit(){return this.hits<this.length&&(this.hits++,!0)}isSunk(){return this.hits===this.length}}class p{#A=10;#B=["horizontal","vertical"];constructor(){this.board=this.#N(),this.ships=[new d("Carrier",5),new d("Battleship",4),new d("Cruiser",3),new d("Submarine",3),new d("Destroyer",2),new d("Destroyer",2)]}placeShip(e,t,s){const n=this.#D(e,t,s);return!!n&&(n.forEach((([t,s])=>{this.board[t][s].placedShip=e})),!0)}placeShipRandomly(e){const t=this.#k(),s=[this.#R(10),this.#R(10)];return this.placeShip(e,t,s)}placeAllShipsRandomly(){this.ships.forEach((e=>{let t=!1;for(;!t;)try{this.placeShipRandomly(e),t=!0}catch(e){}}))}receiveAttack(e){if(!this.#O(e)||!this.#L(e))throw new Error(`Invalid attack at [${e}]`);let[t,s]=e;return this.board[t][s].isPlayed=!0,!!this.board[t][s].placedShip&&(this.board[t][s].placedShip.hit(),this.#T([t,s]),this.board[t][s].placedShip.isSunk()&&this.#F([t,s]),!0)}areAllShipsSunk(){return this.ships.every((e=>e.isSunk()))}#N(){let e=[];for(let t=0;t<this.#A;t++){let t=[];for(let e=0;e<this.#A;e++)t.push(new u);e.push(t)}return e}#D(e,t,s){try{this.#x(e,t,s)}catch(e){throw new Error(e)}const[n,r]=s,a=e.length,i=this.#_(a,t,[n,r]);for(const e of i){if(!this.#M(e))throw new Error(`Cell [${e}] is out of bounds.`);if(!this.#U(e))throw new Error(`Cell [${e}] is not empty.`);if(!this.#$(e))throw new Error(`Cell [${e}] is not adjacent to empty cells.`)}return i}#O(e){return!(!Array.isArray(e)||2!==e.length||!this.#M(e))}#x(e,t,s){if(!(e instanceof d))throw new Error("Invalid placement. Ship object expected");if(!this.#B.includes(t))throw new Error(`Invalid placement. Expects ${this.#B}`);if(!this.#O(s))throw new Error(`Invalid placement on cell [${s}]`);return!0}#M([e,t]){return e>=0&&e<this.#A&&t>=0&&t<this.#A}#U([e,t]){return null===this.board[e][t].placedShip}#L([e,t]){return!this.board[e][t].isPlayed}#$([e,t]){for(let s=e-1;s<=e+1;s++)for(let n=t-1;n<=t+1;n++){if(s===e&&n===t)continue;const r=[s,n];if(this.#M(r)&&!this.#U(r))return!1}return!0}#_(e,t,s){let n=[],[r,a]=s;if("horizontal"===t)for(let t=r;t<r+e;t++)n.push([t,a]);else if("vertical"===t)for(let t=a;t<a+e;t++)n.push([r,t]);return n}#R(e){return Math.floor(Math.random()*e)}#k(){return this.#B[this.#R(2)]}#T([e,t]){for(let s=e-1;s<e+2;s+=2)for(let e=t-1;e<t+2;e+=2)this.#M([s,e])&&(this.board[s][e].isPlayed=!0)}#F([e,t],s=new Set){const n=`${e},${t}`;if(!s.has(n)&&(s.add(n),this.board[e][t].placedShip))for(let n=e-1;n<=e+1;n++)for(let e=t-1;e<=t+1;e++)this.#M([n,e])&&(this.board[n][e].isPlayed=!0,this.#F([n,e],s))}}class u{constructor(){this.placedShip=null,this.isPlayed=!1}}class m{#H=["computer","real"];constructor(e="computer"){this.name=e,this.gameboard=new p}get type(){return this.name===this.#H[0]?this.#H[0]:this.#H[1]}}class y extends m{#a;#q;#G;#Z;constructor(){super(),this.difficulty=0,this.#q=this.gameboard.board.length,this.#G=[],this.#Z=[]}set difficulty(e){this.#a=e<0?0:e>1?1:e}get difficulty(){return this.#a}play(e){return this.#Z=e,0===this.#a?this.#Y():this.#V()}addSuccessfulPlay(e){this.#G.push(e)}#Y(){let e=[];const t=this.#R(this.#q);e.push(t);const s=this.#R(this.#q);return e.push(s),this.#j(e)&&(e=this.#Y()),e}#V(){if(0===this.#G.length)return this.#Y();let[e,t]=this.#G.at(-1);for(let s=e-1;s<=e+1;s++)for(let n=t-1;n<=t+1;n++)if((s===e||n===t)&&this.#z([s,n])&&!this.#j([s,n]))return[s,n];return this.#G.pop(),this.#V()}#j(e){const[t,s]=e;return this.#Z[t][s].isPlayed}#z(e){const[t,s]=e;return t>=0&&t<this.#q&&s>=0&&s<this.#q}#R(e){return Math.floor(Math.random()*e)}}const E=new class{#n=["EASY","MEDIUM","HARD"];#a=this.#n[0];constructor(e="Player",t){this.player1=new m(e),this.player2=t?new m(t):new y(this.#n.indexOf(this.#a)),this.activePlayer=this.player1,this.opponent=this.player2,this.realPlayers=1,this.winner=null,this.player1.gameboard.placeAllShipsRandomly(),this.player2.gameboard.placeAllShipsRandomly()}get difficulty(){return this.#a}set difficulty(e=0){(e<0||e>2)&&(e=0),this.#a=this.#n[e],"computer"===this.player2.type&&(this.player2.difficulty=this.#n.indexOf(this.#a))}play(e){if(!this.winner){"computer"===this.activePlayer.type&&(e=this.activePlayer.play(this.opponent.gameboard.board));try{let t=this.opponent.gameboard.receiveAttack(e);t&&"computer"===this.activePlayer.type&&this.activePlayer.addSuccessfulPlay(e),this.opponent.gameboard.areAllShipsSunk()&&(this.winner=this.activePlayer),t||this.#W()}catch(e){throw new Error(e)}"computer"===this.activePlayer.type&&this.play()}}resetGame(){const e=this.player1.name,t=this.player2.name,s=this.player2.difficulty;this.player1=new m(e),this.player2=this.realPlayers>1?new m(t):new y(s),this.activePlayer=this.player1,this.opponent=this.player2,this.player1.gameboard.placeAllShipsRandomly(),this.player2.gameboard.placeAllShipsRandomly(),this.winner=null}#W(){let e=this.activePlayer;this.activePlayer=this.opponent,this.opponent=e}};new class{constructor(e){this.game=e,this.currentPage=null,this.pages={home:new t(this),playerSelection:new n(this),placeShip:null,game:new l(this)},this.render("home")}render(e){this.currentPage=this.pages[e];const t=document.querySelector("body"),s=(new c).render(),n=(new h).render(),r=document.createElement("main");r.append(this.currentPage.render()),this.currentPage&&(t.innerHTML=""),t.append(s,r,n),t.className=this.currentPage.constructor.name.toLowerCase()}}(E)})();